# inventory/vmware_vms.yml
# =========================
# Inventaire dynamique VMware vSphere
# Plugin officiel : vmware.vmware.vms
# S√©pare les secrets et param√®tres variables !

plugin: vmware.vmware.vms

# üîë Param√®tres d'acc√®s, TOUJOURS inject√©s via credential AAP
hostname: "{{ vcenter_hostname }}"
username: "{{ vcenter_username }}"
password: "{{ vcenter_password }}"

# D√©sactive la v√©rification SSL (√† s√©curiser en prod)
validate_certs: false

# Filtrer : ici toutes les VMs
# Tu peux filtrer sur les dossiers, clusters, etc.
with_tags: false

# Grouper les machines par √©tat d'alimentation
groups:
  powered_on:
    filters:
      - config.template is false
      - summary.runtime.powerState == "poweredOn"
  powered_off:
    filters:
      - config.template is false
      - summary.runtime.powerState == "poweredOff"

# D√©finir quel champ utiliser pour l'adresse IP
compose:
  ansible_host: guest.ipAddress

# Activer la collecte des facts √©tendus (si besoin)
properties:
  - config
  - guest
  - runtime
  - summary

# Contr√¥le strict : stop si doublons
strict: true

# D√©finir les variables d'h√¥tes personnalis√©es
keyed_groups:
  - key: guest.guestId
    prefix: os
  - key: config.hardware.numCPU
    prefix: cpu

# Exclure les templates (important)
filters:
  - config.template is false
